#include "markC.h"
#include "RegistryManager.h"
#include <string>
#include <vector>
#include <Windows.h>

// Static variable for yData
static const std::vector<BYTE> yData = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA8, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00
};

// Windows_10+8.x_MouseFix_ItemsSize=100%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale100()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xCC,
        0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x99, 0x19, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x40, 0x66, 0x26, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x33, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 100)");
}

// Windows_10+8.x_MouseFix_ItemsSize=125%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale125()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 125)");
}

// Windows_10+8.x_MouseFix_ItemsSize=150%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale150()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x33,
        0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x66, 0x26, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x90, 0x99, 0x39, 0x00, 0x00, 0x00,
        0x00, 0x00, 0xC0, 0xCC, 0x4C, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 150)");
}

// Windows_10+8.x_MouseFix_ItemsSize=175%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale175()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x66,
        0x16, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xCC, 0x2C, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x20, 0x33, 0x43, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x80, 0x99, 0x59, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 175)");
}

// Windows_10+8.x_MouseFix_ItemsSize=200%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale200()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x99,
        0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x33, 0x33, 0x00,
        0x00, 0x00, 0x00, 0x00, 0xB0, 0xCC, 0x4C, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x40, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 200)");
}

// Windows_10+8.x_MouseFix_ItemsSize=225%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale225()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xCC,
        0x1C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x99, 0x39, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x40, 0x66, 0x56, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x33, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 225)");
}

// Windows_10+8.x_MouseFix_ItemsSize=250%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale250()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 250)");
}

// Windows_10+8.x_MouseFix_ItemsSize=300%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale300()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xCC,
        0x1C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x99, 0x39, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x40, 0x66, 0x56, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x33, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 300)");
}

// Windows_10+8.x_MouseFix_ItemsSize=350%_Scale=1-to-1_@6-of-11
LONG MouseScaleFix::setScale350()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xCC,
        0x2C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x99, 0x59, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x40, 0x66, 0x86, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x33, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData, "(Scale 350)");
}

// Set scale back to the default values
LONG MouseScaleFix::setScaleDefault()
{

    // Curve data
    const std::vector<BYTE> xData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x15, 0x6e,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x29, 0xdc, 0x03, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    const std::vector<BYTE> yData = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfd, 0x11,
        0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x04, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x12, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0xc0, 0xbb, 0x01, 0x00, 0x00, 0x00, 0x00
    };

    // Apply the mouse fix
    // Returns statusCode (LONG)
    return applyMarkC(xData, yData);
}

LONG MouseScaleFix::applyMarkC(const std::vector<BYTE>& xData, const std::vector<BYTE>& yData, const char* scale)
{

    // [HKEY_CURRENT_USER\Control Panel\Mouse]
    // Make sure key is created and accessible.
    RegistryManager regManager;

    regManager.createKey("Control Panel\\Mouse");

    // Set values
    regManager.createVec("Control Panel\\Mouse", xData, "SmoothMouseXCurve");
    regManager.createVec("Control Panel\\Mouse", yData, "SmoothMouseYCurve");
    regManager.createVal("Control Panel\\Mouse", "10", "MouseSensitivity");

    // Return if any errors so far
    LONG statusCode = regManager.getStatusCode();
    if (statusCode != ERROR_SUCCESS) {
        std::cout << "There was an error setting the values. Error code: " << statusCode << std::endl;
        return statusCode;
    }

    RegistryManager regManagerUsers(HKEY_USERS); // Use HKEY_USERS

    // [HKEY_USERS\.DEFAULT\Control Panel\Mouse]
    // Make sure key is created and accessible.
    regManagerUsers.createKey(".DEFAULT\\Control Panel\\Mouse");

    // Set values
    regManagerUsers.createVal(".DEFAULT\\Control Panel\\Mouse", "10", "MouseSpeed");
    regManagerUsers.createVal(".DEFAULT\\Control Panel\\Mouse", "10", "MouseThreshold1");
    regManagerUsers.createVal(".DEFAULT\\Control Panel\\Mouse", "10", "MouseThreshold2");

    statusCode = regManagerUsers.getStatusCode();
    if (statusCode == ERROR_SUCCESS) {
        std::cout << "The MarkC mouse fix was applied! " << scale << std::endl;
    } else {
        std::cout << "There was an error setting the values. Error code: " << statusCode << std::endl;
    }

    // Return final status code.
    return statusCode;
}

LONG MouseScaleFix::applyMouseFix()
{
    switch (m_scale) {
    case Scale::Scale100:
        return setScale100();
    case Scale::Scale125:
        return setScale125();
    case Scale::Scale150:
        return setScale150();
    case Scale::Scale175:
        return setScale175();
    case Scale::Scale200:
        return setScale200();
    case Scale::Scale225:
        return setScale225();
    case Scale::Scale250:
        return setScale250();
    case Scale::Scale300:
        return setScale300();
    case Scale::Scale350:
        return setScale350();
    case Scale::Default:
        return setScaleDefault();
    default:
        return setScaleDefault();
    }
}